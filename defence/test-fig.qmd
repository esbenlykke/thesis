---
title: "Accelerometry- and Temperature-Based Algorithms to Assess Sleep Habits Among Danish Children and Adolescents"
subtitle: "PhD Thesis Defence"
institute: University of Southern Denmark
author: Esben HÃ¸egholm Lykke
format:
  metropolis-revealjs: 
    transition: fade
    slide-number: true
    preview-links: auto
    template-partials:
      - title-slide.html
    fig-cap-location: bottom
    fig-dpi: 300
# footer: Research Unit for Exercise Epidemiology, Department of Sports Science and Clinical Biomechanics
date: last-modified
date-format: "DD MMMM, YYYY"
logo: ../img/SDU_BLACK_RGB.png
execute: 
  eval: true
  echo: false
  message: false
slide-number: true
embed-resources: true
bibliography: refs.bib
citation: true
css: style.css
# csl: nature.csl
callout-icon: false
editor_options: 
  chunk_output_type: console
---

## Quarto

Quarto enables you to weave together content and executable code into a finished document. To learn more about Quarto see <https://quarto.org>.

## Running Code

When you click the **Render** button a document will be generated that includes both content and the output of embedded code. You can embed code like this:

```{r}
source("code/all_plots.R")

vip_plot

```

# next plot

```{r}
iris %>% 
  ggplot(aes(Sepal.Length, Sepal.Width)) +
  geom_point() +
  theme_classic()
```

# next plot

```{r}
library(png)

sensor_img <- readPNG("img/wrist_sensor.png", native = TRUE)

data <-
  tibble(x = 1:100, y = 1:100)

annotate_text_size <- 4
annotate_lineheight <- 1
box_color <- "#F0F1EB"
font_family <- "Zilla Slab"


flow1 <-
  data |>
  ggplot(aes(x, y)) +
  # scale_x_continuous(minor_breaks = seq(10, 100, 10)) +
  # scale_y_continuous(minor_breaks = seq(10, 130, 10)) +
  # main boxes
  geom_rect(
    xmin = 10, xmax = 40, ymin = 117, ymax = 127, color = "#4DBBD5",
    fill = box_color, linewidth = 0.25
  ) +
  annotate("text",
           x = 25, y = 122,
           label = "Complete PHASAR dataset\nhip + thigh",
           size = annotate_text_size, color = "grey15", lineheight = annotate_lineheight,
           family = font_family
  ) +
  geom_rect(
    xmin = 10, xmax = 40, ymin = 92, ymax = 102, color = "#4DBBD5",
    fill = box_color, linewidth = 0.25
  ) +
  annotate("text",
           x = 25, y = 97,
           label = "PHASAR training set\nhip + thigh",
           size = annotate_text_size, color = "grey15", lineheight = annotate_lineheight,
           family = font_family
  ) + 
  geom_rect(
    xmin = 0, xmax = 15, ymin = 67, ymax = 77, color = "#4DBBD5",
    fill = box_color, linewidth = 0.25
  ) +
  annotate("text",
           x = 7.5, y = 72,
           label = "Resample 1",
           size = annotate_text_size, color = "grey15", lineheight = annotate_lineheight,
           family = font_family
  ) +
  geom_rect(
    xmin = 17.5, xmax = 32.5, ymin = 67, ymax = 77, color = "#4DBBD5",
    fill = box_color, linewidth = 0.25
  ) +
  annotate("text",
           x = 25, y = 72,
           label = "Resample 2",
           size = annotate_text_size, color = "grey15", lineheight = annotate_lineheight,
           family = font_family
  ) +
  geom_rect(
    xmin = 35, xmax = 50, ymin = 67, ymax = 77, color = "#4DBBD5",
    fill = box_color, linewidth = 0.25
  ) +
  annotate("text",
           x = 42.5, y = 72,
           label = "Resample 5",
           size = annotate_text_size, color = "grey15", lineheight = annotate_lineheight,
           family = font_family
  ) +
  annotate("text",
           x = 33.75, y = 72,
           label = "...",
           size = annotate_text_size, color = "grey15", lineheight = annotate_lineheight,
           family = font_family
  ) +
  annotate("text",
           x = 46.5, y = 123,
           label = "20.8%",
           size = 3, color = "grey15", lineheight = annotate_lineheight,
           family = font_family
  ) +
  annotate("text",
           x = 23.8, y = 109,
           label = "79.2%",
           size = 3, color = "grey15", lineheight = annotate_lineheight,
           angle = 90,
           family = font_family
  ) +
  # vertical arrows
  geom_segment(
    x = 25, xend = 25, y = 117, yend = 102,
    linewidth = 0.15, lineend = "butt",
    arrow = arrow(length = unit(1, "mm"), type = "closed"),
    color = "#4DBBD5"
  ) +
  geom_segment(
    x = 25, xend = 25, y = 92, yend = 77,
    linewidth = 0.15, lineend = "butt",
    arrow = arrow(length = unit(1, "mm"), type = "closed"),
    color = "#4DBBD5"
  ) +
  geom_segment(
    x = 15, xend = 7.5, y = 92, yend = 77,
    linewidth = 0.15, lineend = "butt",
    arrow = arrow(length = unit(1, "mm"), type = "closed"),
    color = "#4DBBD5"
  ) +
  geom_segment(
    x = 35, xend = 42.5, y = 92, yend = 77,
    linewidth = 0.15, lineend = "butt",
    arrow = arrow(length = unit(1, "mm"), type = "closed"),
    color = "#4DBBD5"
  ) + 
  geom_segment(
    x = 57.5, xend = 57.5, y = 117, yend = 102,
    linewidth = 0.15, lineend = "butt",
    arrow = arrow(length = unit(1, "mm"), type = "closed"),
    color = "#4DBBD5"
  ) +
  geom_segment(
    x = 75, xend = 75, y = 117, yend = 102,
    linewidth = 0.15, lineend = "butt",
    arrow = arrow(length = unit(1, "mm"), type = "closed"),
    color = "#4DBBD5"
  ) +
  geom_segment(
    x = 92.5, xend = 92.5, y = 117, yend = 102,
    linewidth = 0.15, lineend = "butt",
    arrow = arrow(length = unit(1, "mm"), type = "closed"),
    color = "#4DBBD5"
  ) +
  # horizontal arrows
  geom_segment(
    x = 40, xend = 52.5, y = 122, yend = 122,
    linewidth = .15, lineend = "butt",
    arrow = arrow(length = unit(1, "mm"), type = "closed"),
    color = "#4DBBD5"
  ) +
  # boxes to the side
  geom_rect(
    xmin = 52.5, xmax = 80, ymin = 117, ymax = 127, color = "#4DBBD5",
    fill = box_color, linewidth = 0.25
  ) +
  annotate("text",
           x = 66.25, y = 122,
           label = "PHASAR test data\nhip + thigh",
           size = annotate_text_size, color = "grey15", lineheight = annotate_lineheight,
           family = font_family
  ) +
  geom_rect(
    xmin = 50, xmax = 65, ymin = 92, ymax = 102, color = "#4DBBD5",
    fill = box_color, linewidth = 0.25
  ) +
  annotate("text",
           x = 57.5, y = 97,
           label = "PHASAR test\nhip",
           size = annotate_text_size, color = "grey15", lineheight = annotate_lineheight,
           family = font_family
  ) +
  geom_rect(
    xmin = 67.5, xmax = 82.5, ymin = 92, ymax = 102, color = "#4DBBD5",
    fill = box_color, linewidth = 0.25
  ) +
  annotate("text",
           x = 75, y = 97,
           label = "PHASAR test\nthigh",
           size = annotate_text_size, color = "grey15", lineheight = annotate_lineheight,
           family = font_family
  ) +
  geom_rect(
    xmin = 85, xmax = 100, ymin = 92, ymax = 102, color = "#4DBBD5",
    fill = box_color, linewidth = 0.25
  ) +
  annotate("text",
           x = 92.5, y = 97,
           label = "In-house test\nwrist",
           size = annotate_text_size, color = "grey15", lineheight = annotate_lineheight,
           family = font_family
  ) +
  # coord_cartesian(ylim = c(65, 125)) +
  ylim(69, 125) +
  theme_void() +
  patchwork::inset_element(p = sensor_img,
                           left = 0.83,
                           bottom = .8,
                           right = 0.95,
                           top = 0.97) &
  theme(
    text = element_text(family = "Zilla Slab"),
    plot.background = element_rect(fill = theme_color, color = theme_color),
    panel.background = element_rect(fill = theme_color, color = theme_color),
    legend.background = element_rect(fill = theme_color, color = theme_color)
  )

flow1
```
