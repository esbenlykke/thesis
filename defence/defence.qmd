---
title: "Accelerometry- and Temperature-Based Algorithms to Assess Sleep Habits Among Danish Children and Adolescents"
subtitle: "PhD Thesis Defence"
institute: University of Southern Denmark
author: Esben Høegholm Lykke
format:
  metropolis-revealjs: 
    transition: fade
    slide-number: true
    preview-links: auto
    template-partials:
      - title-slide.html
    fig-cap-location: bottom
# footer: Research Unit for Exercise Epidemiology, Department of Sports Science and Clinical Biomechanics
date: last-modified
date-format: "DD MMMM, YYYY"
logo: ../img/SDU_BLACK_RGB.png
execute: 
  eval: true
  echo: false
  message: false
slide-number: true
embed-resources: true
bibliography: refs.bib
citation: true
css: style.css
# csl: nature.csl
callout-icon: false
---

```{r}
#| message: false
library(tidyverse)
library(ggthemes)
library(ggsci)
library(prismatic)
library(ggwordcloud)
library(ggtext)
library(showtext)
library(lubridate)

showtext_auto()
font_add_google("Montserrat", "Montserrat")
font_add_google("Zilla Slab", "Zilla Slab")


theme_color <- "#F0F1EB"

my_theme <-
  theme_classic(base_size = 25) +
  theme(
    text = element_text(family = "Zilla Slab"),
    plot.background = element_rect(fill = theme_color, color = theme_color),
    panel.background = element_rect(fill = theme_color, color = theme_color),
    legend.background = element_rect(fill = theme_color, color = theme_color),
    axis.line = element_line(linewidth = .2),
    axis.ticks = element_line(linewidth = .2)
  )
```

# Introduction

::: notes
Before presenting the core of my work, I will shortly introduce you to the field.
:::

## Why Do We Care About Sleep?

![](img/sleep_health_effects.png)

::: footer
Feingold et al. 2022
:::

::: notes
Sufficient sleep is important in maintaining overall health. <br> Yet insufficient sleep has become a widespread issue, heightening the risk of many serious illnesses. <br> Good sleep not only benefits physical health but also mental well-being and life quality. It's crucial for healthcare providers to educate patients about sleep health and promote lifestyle changes to enhance it.
:::

## How Is "Good Sleep" Defined?

<br> Good sleep is both the **amount** of sleep and the **quality** of your sleep

::: {layout-ncol="2"}
![Questionnaires and Sleep Logs](img/questionnaire.png){width="70%"}

![Polysomnography (PSG)](img/eeg.png){width="70%"}
:::

::: notes
In simple terms, good sleep is both the amount of sleep you get in a night and the quality of your sleep. <br> Most commonly determined by self-report questionnaires or sleep logs. <br> Gold standard PSG. <br> But we can also evaluate sleep using accelerometers. Wrist-accelerometry being the most common wear-location.
:::

## PSG - The Gold Standard

::: columns
::: {.column width="85%"}
::: {layout="[[-1], [1], [-1]]"}
```{r}
hyp <-
  read_csv("../data/yasa_example_night_young_hypno.csv")

hyp %>%
  mutate(
    time = 1:n(),
    stage = case_when(
      Stage == 0 ~ "Wake",
      Stage == 4 ~ "REM",
      Stage == 1 ~ "N1",
      Stage == 2 ~ "N2",
      Stage == 3 ~ "N3"
    ),
    stage = factor(stage, levels = c("N3", "N2", "N1", "REM", "Wake"))
  ) %>%
  ggplot(aes(time, stage, group = 1, fill = stage, color = stage)) +
  geom_tile(show.legend = FALSE) +
  scale_x_continuous(
    breaks = seq(1, 1000, 120),
    labels = c("22:00", "23:00", "00:00", "01:00", "02:00", "03:00", "04:00", "05:00", "06:00")
  ) +
  labs(x = "Time",
       y = "Stage",
       caption = "Sample hypnogram showing the sleep stage cycles of an eight-hour polysomnography recording.") +
  scale_fill_npg() +
  scale_color_npg() +
  my_theme
```
:::
:::

::: {.fragment .column .smaller-font width="15%" layout-ncol="1"}
![](img/work.png){width="80%"}

![](img/time.png){width="80%"}

![](img/money.png){width="80%"}
:::
:::

::: notes
Polysomnography (PSG):

Gold-standard technique in sleep research.<br> Combines EEG, EOG, EMG, ECG, respiratory and pulse oximetry measurements.<br> Captures comprehensive sleep data in a clinical setting.<br> Useful for diagnosing sleep disorders but costly, requires specialized personnel, and may not reflect free-living sleep conditions. <br> In summary, PSG is not feasible in large-scale studies <br> Note: rater bias -\> objectivity?
:::

## Alternatives to PSG

::: {layout-ncol="2" layout-valign="top"}
::: fragment
![](img/zmachine.png){width="40%"}

**Zmachine® Insight**

-   Validated against PSG
-   Reasonably user-friendly
-   Multiple nights in home
-   Automated scoring
:::

::: fragment
![](img/wrist_acc.png){width="40%"}

**Accelerometry**

-   Several weeks of recording
-   Very small participant burden
-   Suited for free-living conditions
-   Lots of raw data
-   Heuristic algorithms
:::
:::

::: footer
Kaplan et al. 2014, Wang et al. 2015
:::

::: notes
Emergence of single-channel EEG-based sleep staging algorithms.

Zmachine® Insight+ (ZM): Gaining recognition in sleep studies. Validated against PSG, offering comparable data quality. Cost-effective and requires less specialized oversight. User-friendly for multi-night, real-world evaluations. Ideal for machine learning analyses due to consistent multi-night data. Despite advantages, still has considerable costs and participant demands.

Another low-burden alternative is accelerometry.

Heuristic algorithms to score sleep.

Increasing data availability makes the use of ML more advantages.
:::

## Accelerometry for Assessing Sleep

::: {layout-ncol="5" layout-valign="top"}
![](img/algorithm.png)

![](img/blank.png)

![](img/arrow_right.png)

![](img/blank.png)

![](img/DL.png)
:::

Shift towards machine learning as more data becomes available

-   Cole-Kripke algorithm (counts) [@cole_automatic_1992]

-   van Hees algorithm (raw) [@hees_novel_2015]

-   Random Forests in GGIR (raw) [@sundararajan_sleep_2021]

::: notes
Accelerometry as an Alternative to EEG:

Used to overcome limitations of EEG systems and self-reported sleep assessments.

Algorithm Development in Actigraphy:

Evolution from activity count-based to raw acceleration data algorithms. Notable algorithms: ESS (Estimation of Stationary Sleep-segments), algorithm based on accelerometer orientation angle. Shift towards machine learning approaches for enhanced data utilization.

ML have shown superior performance.

Lots of data is necessary to effectively develop robust ML models.
:::

## Machine Learning Basics

<br>

::: {layout-ncol=9}

![](img/training_data.png)

![](img/arrow_right.png)

![](img/DL.png)

![](img/arrow_right.png)

![](img/model.png)

![](img/arrow_right.png)

![](img/testing_data.png)

![](img/arrow_right.png)

![](img/accuracy.png)

:::

- Sleep detection as a supervised learning task
- Learn/train a model using the training data
- Test the model on unseen data
- Assess model performance

::: {.notes}
The goal is to construct a model from example inputs in order to make data-driven decisions rather than following strictly static instructions (heuristic algorithms)

Learning (training): learn model using training data

Testing: test model using unseen data to assess model performance
:::

## Advantages of Manually Labelling Training Data

![](img/label.png){.absolute top=120 left=-70 width=20%} 

<br>

::: {.absolute top=120 left=150}

- Labelled data sourced from PSG or sleep diaries/sleep logs
- Many studies have exclusively collected accelerometer data
- Potential of manual annotations to fill gaps in data
- No participant burden
- Multiple nights for intra-individual variability
- Free-living conditions

:::

![](img/exclamation.png){.absolute top=520 left=0 width=5%} 

::: {.absolute top=520 left=60}
**Precision of manually annotating in-bed time is unexplored**
:::

::: {.notes}

:::

## How To Handle Non-Wear time

<br> 

![](img/incomplete.png){.absolute top=70 left=0 width=15%} 

::: {.absolute top=150 left=180}
Non-wear time is to be considered as missing data
:::

<br>
<br>
<br>

- Handling non-wear time is essential for human behavior analyses
- Accurate differentiation between non-wear and sleep is crucial
- Methods include participant log diaries and heuristic algorithms
- As with sleep, more recent methods to detect non-wear use ML

![](img/exclamation.png){.absolute top=520 left=0 width=5%} 

::: {.absolute top=520 left=60}
**Ongoing search for optimal method to classify non-wear time**
:::


::: {.notes}
Besides accurate labels, the training data must not contain missing data

Essential for accurate human motion and behavior analysis.

Accurate differentiation between non-wear periods and sleep is crucial

heuristic algorithms typically rely on consecutive zero counts

ML methods include random forests and convolutional neural networks

Ongoing search for an optimal method to classify non-wear time in diverse settings
:::

## Limitations of Current ML Methods to Detect Sleep

<br>

:::: columns
::: {.column width=80%}

- Limited exploration of thigh-mounted devices
- Potential advantages in capturing sleep-related behaviors or positions

<br>

- Methods rely on sleep diaries to extract the time in bed
- Potential advantages of consecutive nights

::: 

:::{.column width=20%}
![](img/man.png){width=80%}
![](img/period.png){width=80%}
:::
::::

![](img/exclamation.png){.absolute top=520 left=0 width=5%} 

::: {.absolute top=520 left=60}
**ML on thigh-worn devices is unexplored**
:::

::: footer
Conley et al. 2019, Brønd et al. 2020
:::

::: {.notes}
Most methods focus on data from wrist- and hip-worn devices.

No ML methods to detect sleep used on thigh data

despite the advantages of this sensor location to classify physical activity behaviors


:::

# Thesis Aims and Objectives {.center-text}

<br>

> The overall aim was to develope methods and models for the analysis and interpretation of sleep in accelerometer data

:::: columns
::: {.column width=33% .center-text .smaller-font}
**Paper 1**

Introduce a method for manually annotating in-bed time in raw accelerometry data, validate these annotations against the Zmachine and sleep diaries, and evaluate the consistency of these manual annotations
:::
::: {.column width=33% .center-text .smaller-font}
**Paper 2**
:::
::: {.column width=33% .center-text .smaller-font}
**Paper 3**
:::
::::

::: {.notes}
The overall aim wass bla blabla through these three paper/manuscripts

Paper 1: The objectives of paper I is to present a method for manually annotating individual
bedtime and wake-up times using raw accelerometry data. Furthermore, to validate
the accuracy of these annotations by comparing them with in-bed and out-of-bed
timestamps as determined by the ZM and by a prospective sleep diary, and lastly,
to assess both inter-rater and intra-rater agreement of the manual annotations.
:::


# Acknowledgements

::: columns
::: {.column width="50%"}
In collaboration with...

::: {style="font-size:.8em"}
-   Jan Christian brønd
-   Anders Grøntved
-   Niels Christian Møller
-   Jesper Schmidt-Persson
-   Natascha Holbæk Pedersen
-   Kristian Traberg
-   Peter Lund Kristensen
-   Sofie Rath Mortensen
-   Sara Overgaard Sørensen
-   Malthe Roswall
-   All remaining wonderful colleagues...
:::
:::

::: {.column width="50%"}
Funded by...

![](img/sdu.png){width="50%"} ![](img/trygfonden.png){width="50%"} ![](img/erc.png){width="50%"}
:::
:::

# Thank You!

![](img/clapping.png){fig-align="center"}

# Supplementary Slides

## Duration

![](img/u-shape_all-cause_mortality.png){width="80%"}

::: footer
Yin, J. et al. Relationship of Sleep Duration With All-Cause Mortality and Cardiovascular Events: A Systematic Review and Dose-Response Meta-Analysis of Prospective Cohort Studies. Journal of the American Heart Association 6, e005947 (2017).
:::
